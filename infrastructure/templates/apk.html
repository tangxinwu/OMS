<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>小虎科技</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="/static/css/bootstrap.css">
    <link rel="stylesheet" href="/static/css/font-awesome.min.css">
	<link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/plugin.css">
    <link rel="stylesheet" href="/static/css/landing.css">

    <!--ip 显示界面css-->
    <link rel="stylesheet" type="text/css" href="/static/css/ipTips.css" />
    <!--[if lt IE 9]>
    <script src="/static/js/ie/respond.min.js"></script>
    <script src="/static/js/ie/html5.js"></script>
    <![endif]-->
    <script>
        function post_data() {
            var select_config = $("#current_file").text();
            var file_content = $("#file_content").val();
            $.post("/apk/", {"file_content": file_content, "action": "modify", "select_config":select_config}, function (result) {
               alert(result);
               window.location.href = "/apk/";
            });
        }

        function select_config(obj) {

            var select_config = $(obj).val();
            var all_config_button = $("#config_area input")
            $.each(all_config_button, function (k,v) {
                v.className = "btn-info btn-large";
            });
            $(obj).addClass("btn-danger btn-large");
            $.post("/apk/", {"select_config": select_config, "action": "show"}, function (result) {

               document.getElementById("current_file").innerText = select_config;
               document.getElementById("file_content").innerText = result;
            });

        }

        function start_build() {
            $.post("/apk/", {"action": "build"},function (result) {
               $("#result_area").empty();
               $("#result_area").append(result);
            });
        }
    </script>
    
{#    定时器任务#}
    <script type="text/javascript">
  function refreshlog() {
      //循环执行，每隔1秒钟执行一次 1000
      // 传递已经显示的行数
      var lines = $("#lines").text();

      var t1 = window.setInterval(refreshCount, 5000);

      function refreshCount() {
          if (lines == ""){
              lines = 1
          }else {
              lines = lines + 1;
          }
          $.post("/apk/", {"action": "log", "lines": lines}, function (result) {
              var temp_result = JSON.parse(result);
              $("#result_area").append(temp_result["result"].replace("\n", "<br>").replace("\r", "&nbps"));
              $("#lines").empty();
              $("#lines").append(temp_result["lines"]);
          });
      };
  };

  
  function interruptRefresh() {
        //去掉定时器的方法
        var t1=window.setInterval(refreshCount, 5000);
        window.clearInterval(t1);

  };
    </script>

</head>
<body>
  <!-- header -->
	<header id="header" class="navbar bg bg-black">
    <ul class="nav navbar-nav navbar-avatar pull-right">
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">            
          <span class="hidden-sm-only">{{ logged_user }}</span>
          <span class="thumb-small avatar inline"><img src="/static/images/avatar.jpg" alt="{{ logged_user }}" class="img-circle"></span>
          <b class="caret hidden-sm-only"></b>
        </a>
        <ul class="dropdown-menu">
          <li><a href="/logout/">登出</a></li>
        </ul>
      </li>
    </ul>
    <a class="navbar-brand" href="#"><img src="/static/images/top_logo.png"></a>
    <button type="button" class="btn btn-link pull-left nav-toggle hidden-lg" data-toggle="class:slide-nav slide-nav-left" data-target="body">
      <i class="icon-reorder icon-xlarge text-default"></i>
    </button>
	</header>
  <!-- / header -->
  <!-- nav -->
  <nav id="nav" class="nav-primary visible-lg nav-vertical">
    <ul class="nav" data-spy="affix" data-offset-top="50">
        <li><a href="/ip_interface/"><i class="icon-calendar icon-xlarge"></i>ip管理界面</a></li>
{#        <li><a href="/port_check/"><i class="icon-calendar icon-xlarge"></i>端口检测</a></li>#}
        <li ><a href="/version_update/"><i class="icon-calendar icon-xlarge"></i>版本更新</a></li>
        <li><a href="/logs_gather/"><i class="icon-calendar icon-xlarge"></i>日志界面</a></li>
        <li><a href="/shortcut/"><i class="icon-calendar icon-xlarge"></i>快捷入口</a></li>
        <li><a href="/docker_local_registry/"><i class="icon-calendar icon-xlarge"></i>docker本地仓库镜像列表</a></li>
        <li class="active"><a href="/apk/"><i class="icon-calendar icon-xlarge"></i>apk打包</a></li>
        <li><a href="/h5_update/"><i class="icon-calendar icon-xlarge"></i>h5更新</a></li>
        <li><a href="/go-task/"><i class="icon-calendar icon-xlarge"></i>go-task操作</a></li>
    </ul>
  </nav>
  <!-- / nav -->
  <section id="content">
    <div class="col-sm-12">
        <div class="input-group" style="width: 30%;margin: 2% 0 2% 34%"></div>
    </div>
    <div class="col-sm-12">
        本地安卓文件目录：<label>{{ local_workspace }}/{{ ProjectName }}</label>
    </div>
    <div class="col-sm-6">
            <textarea id="file_content" class="form-control" style="height: 500px;width: 800px;"></textarea>

    </div>

    <div class="col-sm-6" style="text-align: center" id="config_area">
        {% for config in all_build_file_list %}
        <input type="button" value="{{ config }}" class="btn-info btn-large " onclick="var obj=this;select_config(obj);"
        style="float: left">
        {% endfor %}

    </div>
    <div class="col-sm-12" style="text-align: center">
        现在读取的是：<label id="current_file"></label>
    </div>
    <div class="col-sm-12" id="lines"></div>
    <div class="col-sm-6" >
        <textarea id="result_area" style="height: 500px;width:100%;"></textarea>
    </div>
    <div class="col-sm-6">
        <input type="button" value="修改config文件" class="btn-circle btn-large" style="margin-top: 5px;margin-left: 45%" onclick="post_data();">
        <input type="button" value="build apk" class="btn-circle btn-large" style="margin-top: 5px;margin-left: 45%" onclick="start_build();">
        <input type="button" value="刷新日志" class="btn-circle btn-large" style="margin-top: 5px;margin-left: 45%" onclick="refreshlog();">
    </div>
  <!-- footer -->



   <!-- / footer -->
	<script src="/static/js/jquery.min.js"></script>

       <!-- 自定义js -->
    <script src="/static/js/application_update.js"></script>

  <!-- Bootstrap -->
  <script src="/static/js/bootstrap.js"></script>
  <!-- app -->
  <script src="/static/js/app.js"></script>
  <script src="/static/js/app.plugin.js"></script>
  <script src="/static/js/app.data.js"></script>

  <!-- Sparkline Chart -->
  <script src="/static/js/charts/sparkline/jquery.sparkline.min.js"></script>  
  <!-- Easy Pie Chart -->
  <script src="/static/js/charts/easypiechart/jquery.easy-pie-chart.js"></script>
  <script src="/static/js/ie/excanvas.js"></script>
</body>
</html>
